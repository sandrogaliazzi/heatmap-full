import knex from "../mkDatabase/index.js";
import fs from "fs";

//const { parse } = require('date-fns');

const entrada = `LUIS OTAVIO KUNST;25/07/2025
PEDRO MICALCE PESQUEIRA PRESTES;24/07/2025
CASSIANA STRASSBURGER ARDENGHI;25/06/2025
AMANDA PAOLA VENTURA ANTONIO;20/07/2025
TIAGO PERES ALOS RODRIGUES;17/08/2025
ANA MARIA SOUZA DE FREITAS;25/07/2025
GABRIEL FELIPETTO DO ROSARIO;20/07/2025
DEBORA CRISTINA PEDROSO MARTINS;27/06/2025
GILVAN LARA DA ROSA;21/07/2025
LUCIA HELENA RAYMUNDO;25/06/2025
NADIR ANTONIO CALZA;28/06/2025
IVAN DOS SANTOS MORALES;10/07/2025
ELIANDRA DA SILVA SANTOS;16/07/2025
YAN SILVA DA ROSA;23/07/2025
MARIA OLIVIA MOROSSINO DIAS;10/07/2025
ELEMAR DARCI MACHADO;20/07/2025
FABRICIO LUAN PACHECO DA SILVA;05/07/2025
ADEMIR SIDNEI HACK;20/07/2025
NELSON DIEGO STUBERGER;21/07/2025
JENIFFER BACKES PEREIRA;25/07/2025
MICHELI TAUANA DA SILVA PRUSSIANO;25/06/2025
MICHELI TAUANA DA SILVA PRUSSIANO;25/05/2025
ORDALINO CAMARGO DOS SANTOS;25/07/2025
MIKAEL LEMES;10/07/2025
CELONI DA ROSA SANTOS;25/07/2025
EDINEIA DUTRA DO PRADO;25/07/2025
ANGELA MARIA MATIAS;15/08/2025
JOAO GABRIEL GOETZ DE BARROS;20/06/2025
CASSIANO MULLER;26/07/2025
DOUGLAS ROSA DA SILVA;20/07/2025
MAURICIO DOS SANTOS SILVA;22/07/2025
GUSTAVO RAMOS DOS SANTOS;10/07/2025
RITIELE FERREIRA VENEGA;15/07/2025
MARCELO SANTOS;25/07/2025
LILIAN MORAES DOS SANTOS;10/08/2025
MARCOS DE ABREU;20/07/2025
SILVANA BOZIQUE;01/07/2025
TIELE SIANE RAMOS DOS SANTOS;10/07/2025
CARLOS ROBERTO CHAVES;25/07/2025
LEO IRINEO SCHAEFER;20/07/2025
GUILHERME VICTOR ANTONIO;20/07/2025
CLEONICE MARIA DE CARVALHO VIECELI;10/07/2025
CLEONICE MARIA DE CARVALHO VIECELI;05/07/2025
SIDNEI LUIZ DA SILVA;05/07/2025
JADER IEGON MARQUES DE SOUZA;25/07/2025
ELENIZE PEREIRA DOS SANTOS;28/06/2025
PATRICIA OLIVEIRA GALSKI DA VEIGA;25/07/2025
LORENI BUENO AVILA;25/06/2025
MARCOS GRADE;10/07/2025
CRISTIANO PEREIRA ROSA;25/07/2025
MEIRE DA CRUZ;10/07/2025
DANIELA LETICIA ARTEIRO;10/07/2025
DENISE QUEIROZ;05/07/2025
ANDRE HAVILLA PEREIRA DA COSTA;25/07/2025
NESTOR CESAR PEIXOTO;25/07/2025
SCHAIANE ANDREIA DOS SANTOS;25/06/2025
GABRIEL KRUMMENAUER;20/07/2025
FERNANDA DA SILVA DOS SANTOS;10/07/2025
D\SAUDE - CENTRO DE MOVIMENTO E VITALIDADE LTDA;20/07/2025
JONAS DE LIMA HINSCHINCK;25/07/2025
RONALDO MUMBACH VIEIRA;22/07/2025
KAUAN LEITE DOS SANTOS;25/07/2025
RAIMUNDO SILVEIRA DE OLIVEIRA;05/07/2025
CAMILA DESCOVI;10/07/2025
VANDER SAMUEL BAUM;10/07/2025
MAURICIO BILHAO;10/07/2025
ELIDA BRIZOLA GOMES BUENO;20/07/2025
UELINTON DE CARVALHO DA SILVA;25/06/2025
WLADIMIR RODRIGUES;20/07/2025
LEANDRO LUIZ MARIA;10/07/2025
KELI DA ROCHA RODRIGUES DOS SANTOS;05/07/2025
SABRINA DOS SANTOS DA SILVA;10/07/2025
AMANDA BERNARDO DA SILVA;10/07/2025
IASMIM LINDENMEYER FERNANDES;10/07/2025
MARCOS ANDRE KLEIN IBING;15/06/2025
RICARDO PIRES DOS SANTOS;20/07/2025
ISADORA SILVA DA SILVEIRA;20/07/2025
ISADORA SILVA DA SILVEIRA;20/06/2025
MAURO ROBERTO BAUM;20/07/2025
AUGUSTO LEMES RIBEIRO;20/07/2025
NATALIA PASSOS SIMOES;06/07/2025
ALDAIR ARNDT;25/07/2025
TALIA GABRIELI SILVA DA ROSA;22/07/2025
KELYN SOLANGE MIDTELSTED;22/07/2025
ENOCH JACQUES DA SILVA;20/07/2025
RUI ALAIDES CAVALHEIRO;28/07/2025
RUI ALAIDES CAVALHEIRO;28/06/2025
LAERCIO AZEREDO PEREIRA NUNES;21/07/2025
MARCELO DELLA LIBERA;20/07/2025
CARINA GALSKI DE FREITAS;10/07/2025
ANA GLORIA BLUME;15/08/2025
FELIPE DE MELLO DE OLIVEIRA;12/07/2025
CATIA REGINA DOS SANTOS PEREIRA;05/07/2025
MARILISI PEREIRA SCHUSSLER;10/07/2025
VALDERLEI FERREIRA ROESLER;15/08/2025
CATIUSSA ANDREIA MOREIRA;06/07/2025
LIZANDRA NEGRI;20/07/2025
LUCAS DOS PASSOS NUNES;10/07/2025
TIAGO RICARDO TAVARES;10/07/2025
VERIDIANA INACIO DOS SANTOS;10/07/2025
CRISTINA LUIZA DREWKE DA SILVA;05/07/2025
ALCIDES LUIZ DE OLIVEIRA;20/07/2025
ELISANDRA FARIAS TEIXEIRA;05/07/2025
ANILDO BRAZ ARAUJO;10/07/2025
SUELEN BORGES SILVA;25/07/2025
TATIANA BRITES DOS SANTOS;10/07/2025
ODAIR CAMARGO VANIM;25/07/2025
ELCIDIO DA SILVA VIANNA;15/07/2025
ELISEU BRIZOLA DA SILVA;25/07/2025
ADRIANA SCHEFER;25/07/2025
FRANCIELE SILVA DA SILVEIRA;20/07/2025
LAUANA VAZ DA SILVA;10/07/2025
IURI PATRICK DOS SANTOS;25/07/2025
VERA LUCIA REIS DA SILVA;28/07/2025
NADIR TEREZINHA SCHOWEITZER;20/07/2025
GRAZIELE DE LIMA DE SAIBRO;28/06/2025
CLEITON GABRIEL DE CAMPOS;25/07/2025
GABRIEL SILVA DE MIRANDA;25/07/2025
LILIAN DE SOUZA MOREIRA;05/07/2025
MARCOS DOS SANTOS DUARTE;10/07/2025
MANOEL STEFFEN;15/07/2025
EVELYN KALLER FERREIRA;25/07/2025
RENI ROGERIO BRAUN;10/07/2025
MARCIA JASCULSKI VAZ;10/07/2025
IRANI DOS SANTOS MATIAS;10/07/2025
EVERTON MARTINS DORNELLES;10/07/2025
ROGERIO SANTOS DA CRUZ;19/07/2025
SANDRA MARA DA SILVA VARGAS DA SILVA;25/07/2025
JOANA MARIA KUZMINSKI;20/07/2025
FERNANDA BEIER DA ROCHA;05/07/2025
FRANCIELI MOREIRA BUENO;25/06/2025
RAFAEL DA ROSA;10/07/2025
MICHELLE FELICETTI;20/07/2025
JUCELIA WALBRINK OLIVEIRA;25/06/2025
TAINARA DE LIMA;25/07/2025
BRUNO LEONARDO DOS SANTOS;25/07/2025
MARTA ROSA FROHLICH;10/07/2025
ELISANDRO DE MATTOS;20/07/2025
ELAINE SIRLEI DE OLIVEIRA DA SILVA;10/07/2025
DIRLENE STRASSBURGER SILVA;10/07/2025
SHEILA SUELEN NIEDZULKA FERNANDES;20/07/2025
NAIR FROHLICH DE OLIVEIRA;10/07/2025
LUANA DORNELLES SCHABAT;10/07/2025
SERGIO ORI DA SILVA;25/06/2025
ALINE FREITAS DE SOUZA;10/07/2025
ADENILSON DE OLIVEIRA LIMA;25/07/2025
FRANCISCO SANTOS PRADO;25/07/2025
EZEQUIEL DA SILVA FARIAS;10/07/2025
JEAM FELIPE BORGUETTI;20/07/2025
VERA BEATRIZ FLESCH;10/07/2025
SONIA REGINA JOBIM JACQUES;20/07/2025
CRISTIANE DE BRITO;25/06/2025
ALINE TERESINHA MARTINS DA SILVA;15/07/2025
MOISES MULLER;25/07/2025
CLEITON ANDRE DE ARAUJO;20/07/2025
FELIPE WAGNER DE OLIVEIRA;20/07/2025
DIONE BACKAUS;05/07/2025
LINTO PEREIRA DOS SANTOS;25/07/2025
GUSTAVO BUSSA;10/07/2025
GILDERSON MACEDO KLEIN;10/07/2025
VINICIUS BARRETO DA SILVA;06/07/2025
ZILMAR ANTUNES DA ROSA;20/07/2025
WESLEY DA SILVA MENDONCA;18/08/2025
MARCIA REGINA BECKER;27/07/2025
FABIANE CRISTINA CORREA KONRAD;15/07/2025
JONAS DE OLIVEIRA ZANATTO;10/07/2025
ONEIDA SUZANA OLIVEIRA CORREA;08/07/2025
PAULA GABRIELE MACHADO;20/07/2025
MARLON ROSA FROHLICH;27/06/2025
MARCIO ANDRE DA SILVA ROCHA;25/07/2025
LUCAS EDUARDO SILVA DOS REIS;10/06/2025
JOSE VALMIR BERNARDES JUNIOR;15/07/2025
EVANDRO DE SOUZA;28/06/2025
WILLIAM DE SOUZA;25/06/2025
TAIELE KAUANA BOTTON RIBEIRO;04/07/2025
CARMEN REGINA BECKER;20/07/2025
JOAO MARCIANO DOS SANTOS;05/07/2025
GILBERTO TREZZI;20/07/2025
GUILHERME U SLEI DE MELLO;15/07/2025
ANA PATRICIA DA SILVA;25/07/2025
LEANDRO DE VARGAS;20/07/2025
PATRICIA FAGUNDES RODRIGUES;20/07/2025
MOACIR JOSE GREBIN;25/07/2025
ALEXANDRE OLIVEIRA DIAS;25/07/2025
KELZIA SANTOS DE SOUZA;25/06/2025
VILSON ALEXANDRE KAISER;20/07/2025
PAULINA LORENZ;22/07/2025
LINDIMAR NUNES DE MELO;25/07/2025
SELMAR JOELSON SIMON;28/06/2025
JANICE DE LIMA SILVA DEUS;25/07/2025
NATIELI FELLES DE ALMEIDA;10/07/2025
LIRIO ALEXANDRE WAMER;05/06/2025
LIRIO ALEXANDRE WAMER;05/07/2025
VIVIANE MARQUES DE OLIVEIRA;20/07/2025
DOUGLAS DA SILVA DE SOUZA;25/06/2025
EDSON RODRIGO LOCHNER;25/07/2025
IVANA MORGANA MULLER;25/07/2025
MARINISE DA ROSA FRICKS;10/07/2025
SYDNEI ROSSI;10/07/2025
MARIA LUISA DE JESUS;20/07/2025
BRENDA ALESSANDRA LEAL DIAS;26/07/2025
QUELEN VITORIA DA SILVA MARQUES;10/07/2025
PAULA ADRIANA DE ARRUDA;18/07/2025
ADRIAN WILLIAM MACHADO;20/07/2025
JENIFER RIBEIRO DA SILVA;10/07/2025
ELIZABETE FATIMA BRERO;05/07/2025
VALDEMIR MENEZES;10/07/2025
FERNANDA PAIM LAUFFER;22/07/2025
LUCIANO SIDNEI SILVA DE PAULA;25/07/2025
JOEL MARTINI;17/07/2025
CLEITON RAMON FETTER SCHMITT;10/07/2025
DIEGO MATEUS DAMACENO DE OLIVEIRA;20/07/2025
BERNADETE DE OLIVEIRA;10/07/2025
VANUSA RODRIGUES POSSER SCHAFER;25/07/2025
MARCIELA CATRIANE DA SILVA;20/07/2025
GABRIEL DE OLIVEIRA;20/07/2025
SILVANA MARCIA MARSCHALL;10/07/2025
JAQUELINE VERIDIANA BERNARDES DA SILVA;15/07/2025
TAINARA DE ARAUJO;10/07/2025
WAGNER CASQUERO CHAMORRA;10/07/2025
DELMAR CARLOS FLECK;26/06/2025
UILIAN EDUARDO GARCIA;10/08/2025
UILIAN EDUARDO GARCIA;10/07/2025
MARTA BEATRIZ ROHDE ERTE;25/06/2025
YURI GABRIEL ZILES DE MORAES;10/08/2025
MANOEL ANTONIO DE SOUZA;20/06/2025
RAFAEL MOLLER DA SILVA;20/07/2025
DIANDRA TAIS SCHEUERMANN;05/07/2025
JEBERSON LUIS ROSA;10/07/2025
JESSICA VARGAS DA SILVA;25/07/2025
LUANA DE SALLES DA SILVA;25/07/2025
JOSE DOUGLAS MARINHO DOS SANTOS;05/08/2025
ELIAS CARVALHO DE FRAGA;21/06/2025
MARIA NAIR MARTINS;26/07/2025
MARTA BALIEIRO DE SOUZA SOARES;25/07/2025
OSVALDINA CASTANHO DE OLIVEIRA;10/07/2025
RENATA BRENTANO;10/09/2025
LEONARDO FERNANDO DE ANTONIO;25/06/2025
RENATA BRENTANO;10/08/2025
JOAO BATISTA TREZZI;20/07/2025
NICOLAS BENNECH VERCINO;25/07/2025
LEANDRO WISNEWSKI;10/07/2025
LUDMILA BLANCO DE MIRANDA;28/07/2025
JENNIE CAROLINE PIRES DA SILVA;25/07/2025
LEONIR PATRICK STEFFENS;25/07/2025
TOBIAS PRADO RAMOS;22/07/2025
VINICIUS EDUARDO VARGAS;25/07/2025
MARCOS ANDRE DA SILVA FERREIRA;22/07/2025
ROSEMARI DOS SANTOS;10/07/2025
EDERSON GUILHERME DE SOUZA;10/07/2025
GUSTAVO HENRIQUE KELLERMANN;26/07/2025
FABIANA DA ROSA;25/07/2025
INGRID DE FATIMA DA SILVA SALDANHA;20/07/2025
ELISANDRA DA SILVA FARIAS;10/08/2025
DARCI NICLOTI;10/07/2025
ELENICE DA SILVA;12/07/2025
EMERSON CRISTIANO PINTO FIUZA;10/07/2025
EMERSON RAMA QUADROS;05/08/2025
EDSON ANTONIO SEGATO;25/06/2025
ANDRIELI CAETANA MACHADO;20/07/2025
JULIANO AMARAL DA CUNHA;10/07/2025
SONIA MARA VIANA;15/07/2025
DEISE CELESTE RONNAU;10/07/2025
CRISTIANE PEDROTTI DOS SANTOS PINTO;20/06/2025
MARA REJANE MUMBERGER;20/07/2025
OSEIAS DOS SANTOS;10/07/2025
ADELAIDE MUMBACH;10/07/2025
EDUARDA DA SILVA MATIAS;10/07/2025
JOSE ALEXANDRE SILVA DOS SANTOS;10/07/2025
ELAINE DA SILVA RODRIGUES;19/07/2025
MARISTELA DA SILVA MOEHLECKE;25/07/2025
EULER MURIEL JACOBUS;25/07/2025
CLEDERSON JOSE ALVES;20/07/2025
CLEDERSON JOSE ALVES;15/07/2025
WILLIAM GILBERTO ZIMMER;28/07/2025
DIEGO FERNANDO KERSCHNER;10/08/2025
DIEGO FERNANDO KERSCHNER;10/07/2025
JULIANO DRESCH;14/07/2025
ANA CLAUDIA DA SILVA;23/07/2025
MARINO SCHULTZ;25/07/2025
ROSELENE LIMA DE MENEZES;15/07/2025
ANTONIO VALDERI DE OLIVEIRA PRUSSIANO;05/07/2025
ADRIANA DE OLIVEIRA DE MELLO;13/07/2025
DAIANE DA SILVA;10/07/2025
ADRIANE PORTES DA SILVA;15/07/2025
KATIUSCIA GOMES DA SILVEIRA;10/07/2025
WILLIAM PRADO CANDIA;22/07/2025
JOEL COUTO DE SOUZA;28/07/2025
JOEL DA SILVA RIEGEL;25/07/2025
ADELAR VERGUTZ;05/07/2025
CAMILA OLIVEIRA SANTOS;25/07/2025
GELSON LUIS DE OLIVEIRA;10/07/2025
EVERTON DE VARGAS;08/07/2025
FABIO SKRZYPCZAK;10/07/2025
ERIVELTO DE SOUZA MARTINS;15/07/2025
ANDREI MARQUES LAZZARETTI;28/06/2025
LEANDRO ARRUDA RODRIGUES;10/07/2025
ADRIANA DE LIMA KOVALSKI;20/07/2025
VERA LUCIA JOAQUIM DA SILVA;25/07/2025
ELIANE APARECIDA MACHADO;15/07/2025
NADIA DE OLIVEIRA TORMES;10/07/2025
ANGELA ANDREIA MERGENER;10/07/2025
LEDA MARIA DE OLIVEIRA;20/06/2025
JOSEMARA GONCALVES DIAS;26/06/2025
JESSICA MORGANA FERNANDES CAMPOS;20/06/2025
IRMA MORAES;05/07/2025
VANESSA DIAS;20/07/2025
ISADORA BAYER RIBEIRO DA COSTA;25/06/2025
VANEA REGINA PINHEIRO FRAGOSO;10/07/2025
58.424.986 JANDREI OLIVEIRA RAMOS;10/07/2025
RONALDO LUIS DA SILVA;10/07/2025
SUZANA MARIA WAGNER;10/07/2025
RAFAEL PEREIRA CASTRO;05/07/2025
FABIO ROSIN OLIVEIRA;10/08/2025
RANGEL MUMBACH VIEIRA;15/07/2025
ESMELINDA PORTES;20/07/2025
JOSE CLAUDIO DE SOUZA VERDEJO;15/07/2025
ALEX BATISTA;15/07/2025
ALEX BATISTA;15/07/2025
ROBSON MATHEUS SOARES;15/07/2025
JUNIOR DA SILVA;15/08/2025
MARTA MARIA DO NASCIMENTO CORREA;25/06/2025
RAFAEL ALEXANDRE DEBESAITIS;20/07/2025
JOSE SILVIO FERREIRA;10/07/2025
FABIO GIUGNO SBRUZZI;15/06/2025
MARINES CASTANHO DE OLIVEIRA;10/07/2025
TANISE DA COSTA DE MOURA;10/08/2025
CARINE SOUZA DE OLIVEIRA;12/07/2025
LAURA DE FATIMA MARCIANO;10/07/2025
MARIA ADRIANA DE SOUZA;25/07/2025
MARIA CRISTINA DOS SANTOS;20/07/2025
CATIELI DA SILVEIRA MULLER;20/07/2025
RODRIGO WILSON MULLER;20/07/2025
LUCIANO ANTONIO HOFFMANN;15/07/2025
MARCIO AMARAL DA SILVA;15/07/2025
GABRIEL FLORES PAULI;25/06/2025
JAQUELINE HELFENSTEIN;25/06/2025
CLEITON MENGUES;12/07/2025
RAMON MICHEL WEGNER;10/07/2025
ALINE FREITAS DE SOUZA;15/07/2025
IVANIR LEMES;10/07/2025
ELITON FERREIRA VARGAS;10/07/2025
KARINE DORILDES OLIVEIRA;10/07/2025
LUIZ CARLOS DA SILVA;28/06/2025
JORGE ALEXANDRE ROSA;25/06/2025
JUARES ROGOSKI;10/07/2025
JAIR DUTRA FELIMBERTY;10/07/2025
CARINA LUCIANA MELO MANIQUE DA SILVA;28/06/2025
AMILTON UBIRAJARA BOAVENTURA BATISTA;16/07/2025
CELSO SPIELMANN;10/07/2025
ROSANE FREITAS DA SILVA;20/07/2025
MAICON DOS SANTOS CABRAL;25/06/2025
CAMILA SANTANA DIAS;20/06/2025
ZELONIR CANDIDO CLEZAR;10/07/2025
VIVIANE PEREIRA DA SILVA;10/07/2025
CATIANE ABREU DA SILVA;20/06/2025
MARIA HELENA DE SOUZA RODRIGUES;12/07/2025
JULIA DALSOTTO DA SILVA;25/06/2025
GABRIEL GARCIA DE LIMA;25/06/2025
MARIA ELISETE DE CARVALHO;10/07/2025
RODRIGO MARQUES BRIZOLLA;25/06/2025
ENIO JOSE FRANCISCONI;25/06/2025
SIGBERTH PAULO WIRTH;15/07/2025
LARA EMANUELLI GAYER;25/06/2025
BARBARA SACHERTT;10/07/2025
CENTRO DE REABILITACAO E RECUPERACAO PARA DEPENDENTES QUIMICOS AMOR A VIDA LTDA;20/06/2025
VILSON ALDOIR TEIXEIRA DOS SANTOS;28/06/2025
ROZANE APARECIDA WEBER;15/07/2025
ANDREIA FATIMA MARIANO;15/07/2025
IVO VARGAS DE JESUS;15/07/2025
ELEICIRDES SILVA DE OLIVEIRA;25/06/2025
PAULO ROBERTO DA SILVA;10/07/2025
CAROLAINE VARGAS MACHADO;15/07/2025
FLAVIO ANTONIO BITELLO;10/07/2025
SIRLEI BUENO CAMARGO;10/07/2025
MARIA CLAUDETE SOARES LEAL;15/07/2025
JAIR WEIZEMANN;11/07/2025
CASSIA LECIANA CARDOSO DE MELLO;07/07/2025
JAIR JOSE DE OLIVEIRA;10/07/2025
ALEX DOS SANTOS KAZIANER;25/06/2025
SILVIA VERENICE STOLL DE SOUZA;25/07/2025
ARCELIO FLESCH;10/07/2025
FABIANA LUCIA FRASSAO DA SILVA;10/07/2025
ARLEM ARNULFO TASSO;15/07/2025
JULIO PAULO DE SOUZA BRITZKE;10/07/2025
EDIANE DOS SANTOS BARBIERI;10/07/2025
VANESSA DOS SANTOS DORNELLES ROSA;25/07/2025
NADINE TAINA CORREA DA SILVA;15/07/2025
CLAUDIO IRINEU BOHN;28/06/2025
ADRIANO ALVES;25/07/2025
MARISTELA ADRIANA HAAG DOS SANTOS;01/07/2025
JULIANA RIBEIRO MACHADO;10/07/2025
SINARA TATIANE CARDOSO;15/07/2025
PEDRO PAULO ERTHAL;15/07/2025
ARNO DE CAMARGO;15/07/2025
VALERIA ADRIANA JUNGBULLTT DA CUNHA;25/07/2025
JEDERSON TORAL;10/07/2025
ANA PAULA SILVEIRA;10/08/2025
PAULO MARLON DOS REIS PRATES;10/07/2025
ARNILDO HENKEL NETO;15/07/2025
NOEMI FULBER ELTZ;15/07/2025
JULIO CESAR VOLMANN MACHADO;10/07/2025
GABRIEL EDUARDO WELTER;10/07/2025
MARIA DOLORES GEHLEN CARLOTO GARCIA;25/06/2025
GISLAINE DE SOUZA;15/07/2025
JESSICA BUECH KLAUS;15/07/2025
JOICE TAILINE GOMES;10/08/2025
YOHANA MONTEIRO CLASER;15/07/2025
ELIZETE DE ALMEIDA AMARAL;15/07/2025
FABRICIO FRAGA DE SOUZA;10/07/2025
BIANCA FRANCIELE DE ALMEIDA MACHADO;10/07/2025
GUSTAVO BORBA DA SILVA;25/06/2025
MAGALI BATISTI;10/07/2025
MAGALI BATISTI;10/06/2025
MADALENA APARECIDA BORGES;25/07/2025
ROGER VINICIUS DOS REIS GOMES;05/07/2025
GIANE MARILIA GRINGS;25/06/2025
ALLISON ALEXANDRE DOS SANTOS;10/07/2025
CLIDIANE SARETTA RODRIGUES;15/07/2025
SERGIO ROBERTO VARGAS RIBEIRO;10/07/2025
ERENI SCHEIBE;15/07/2025
JESSICA DE LIMA;20/07/2025
MARONI DA SILVA CAIPER;15/07/2025
CARTEL DA MUSICA LTDA;15/07/2025
IGOR CARDOSO PEREIRA;15/07/2025
VITORIA DE VARGAS CEZAR;15/08/2025
NATAN PEDROSO CARDOSO;15/07/2025
RONALDO C S DE ABREU;10/07/2025
WELYNTON DE CAMPOS ZIMPEL;20/06/2025
MERIANE ROSA DA SILVA;22/06/2025
VIVIANE RAQUEL DESCOVI;28/07/2025
NAIRA ROSEL KIRSCH;15/07/2025
CAMILA CABERLON CRUZ;05/07/2025
TIAGO OCHOA HOFFMEISTER;10/07/2025
LUCAS ALEXANDRE BUENO WEBER;25/06/2025
ALEXANDRE MATTOS VARGAS;25/07/2025
WTW TRANSPORTES LTDA;10/07/2025
JOAO FRANCISCO DE MORAES;15/07/2025
ERICO ROBERTO MACHADO;10/07/2025
JESSICA KONRATH DIAS DE OLIVEIRA;15/07/2025
EVANDRO DE ASSIS CORREIA;25/06/2025
JO O MARCOS DE MORAES;28/06/2025
PAULO CELIRIO PACHECO GEWEHR;25/06/2025
TATIANE LUCIA DE MELLO;25/06/2025
CAROLINE DA SILVA DUTRA;16/06/2025
SIDNEI DA LUZ;10/07/2025
JOSE ROBERTO VAZ DA ROSA;15/07/2025
JAQUELINE DENISE DA SILVA;28/06/2025
FELIPE ROHR;25/06/2025
ADILSON CEZAR CASSEL;15/07/2025
ANDERSON REINOLDO JORIX;11/07/2025
JEFERSON MARCELO HENICKA;10/07/2025
JOSIANE PRISCILA COSTA DA SILVA;15/07/2025
JANIFER PRESTES;21/07/2025
ESTEL MARIS DA SILVA FERREIRA;10/07/2025
VALDECIR POTRATZ;10/07/2025
CAROLINA TAIZA SCHAEFER;15/07/2025
JESSICA SIQUEIRA;10/06/2025
AMANDA VITORIA BORBA DA SILVA;10/07/2025
VINICIUS MOLTER;10/08/2025
NARA REICHERT;10/07/2025
MARCIA DENISE BOHRER;20/07/2025
LOIVA DA LUZ BARBOSA;10/08/2025
JORGE MARCELO ZIMMERMANN;08/07/2025
CARMELIA AMBIENTES INDUSTRIA E COMERCIO DE MOVEIS LTDA;01/07/2025
FERCON COM. DE FERRAGENS E FERRAMENTAS LTDA;20/06/2025
JOSE RENATO WALBER;10/07/2025
GISLAINE MARIA DIAS;15/07/2025
EDSON CARLOS DIAS PEREIRA;10/07/2025
JESSICA DA SILVA ALECIO;06/07/2025
ELIDA ROSIMERI DOS SANTOS;28/06/2025
ELIDA ROSIMERI DOS SANTOS;20/06/2025
LUIZ ANTONIO DA LUZ OLIVEIRA;28/06/2025
LOURDES FILIPIAKI DOS REIS;15/07/2025
DANIEL INACIO DOS REIS;15/07/2025
CLAUDIA ADRIANI MATANA DE OLIVEIRA;10/07/2025
NICOLE FLOR RADEL;28/06/2025
VAGNER SANTOS;15/07/2025
EDUARDO DE SOUZA MACIEL;10/07/2025
EDUARDA BALDIN LUDWIG;23/06/2025
DENILSON CEZARIO DA SILVA;10/07/2025
JOSE RICARDO SCHMIDT;10/07/2025
MARIA EDUARDA BERNARDI SCHENKEL;15/07/2025
JARDEL DA ROSA DINIZ;20/06/2025
VLADIMIR MARTINI KARPSS;10/07/2025
PEDRO NEREU DUARTE DA SILVA;15/07/2025
ADAIR SARMENTO MACIEL;20/06/2025
FABIANO LUIS DE OLIVEIRA;10/07/2025
JURACI MARTINS DE ALMEIDA;11/07/2025
WALDEMAR DIAS;25/06/2025
CELSO DELATEA;10/07/2025
ADIMILSON EDIVAN SCHUH;25/06/2025
ELAINE MARIA DE AGUIAR;10/08/2025
TAINA COSTA VIEIRA;14/07/2025
ALZIRA DE SOUZA;10/08/2025
RAQUEL COELHO DA COSTA OLIVEIRA;10/07/2025
GABRIEL PRATES;01/07/2025
TIAGO ROSA  DOS REIS;10/07/2025
7AZ SOFTWARES LTDA;16/07/2025`.trim();

// Transforma em array de pares [nome, data]
const registros = entrada.split("\n").map(linha => {
  const partes = linha.split(";");
  const nome = partes[0].replace(/'/g, "''").trim();
  const data = partes[1].trim().split("/").reverse().join("-");
  return [nome, data];
});

// Divide em blocos de 50
const dividirBlocos = (array, tamanho) => {
  const blocos = [];
  for (let i = 0; i < array.length; i += tamanho) {
    blocos.push(array.slice(i, i + tamanho));
  }
  return blocos;
};

const gerarQuery = bloco => {
  const valuesSQL = bloco
    .map(([nome, data]) => `('${nome}', '${data}')`)
    .join(",\n        ");
  return `
WITH entradas (nome_razaosocial, data_vencimento) AS (
    VALUES 
        ${valuesSQL}
),
pessoas_encontradas AS (
    SELECT 
        e.nome_razaosocial,
        e.data_vencimento,
        p.codpessoa
    FROM entradas e
    LEFT JOIN mk_pessoas p 
        ON p.nome_razaosocial = e.nome_razaosocial
),
faturas_combinadas AS (
    SELECT 
        pe.nome_razaosocial,
        pe.data_vencimento,
        pe.codpessoa,
        f.codfatura
    FROM pessoas_encontradas pe
    LEFT JOIN mk_faturas f 
        ON f.cd_pessoa = pe.codpessoa 
        AND f.data_vencimento = pe.data_vencimento
        AND f.excluida = 'N'
),
resultado_final AS (
    SELECT
        nome_razaosocial,
        data_vencimento,
        COUNT(DISTINCT codpessoa) AS total_pessoas,
        COUNT(*) FILTER (WHERE codfatura IS NOT NULL) AS total_faturas,
        COUNT(DISTINCT codpessoa) FILTER (WHERE codfatura IS NOT NULL) AS pessoas_com_fatura,
        MIN(codfatura) AS codfatura_real
    FROM faturas_combinadas
    GROUP BY nome_razaosocial, data_vencimento
)
SELECT
    CASE 
        WHEN total_faturas > 1 AND pessoas_com_fatura > 1 THEN 3
        WHEN total_pessoas > 1 AND total_faturas = 0 THEN 0
        WHEN total_faturas > 1 THEN 1
        ELSE COALESCE(codfatura_real, -1)
    END AS codfatura,
    nome_razaosocial AS nome,
    data_vencimento AS data
FROM resultado_final;`;
};

(async () => {
  try {
    const blocos = dividirBlocos(registros, 50);
    const resultados = [];

    for (let i = 0; i < blocos.length; i++) {
      console.log(`🔍 Executando bloco ${i + 1}/${blocos.length}...`);
      const query = gerarQuery(blocos[i]);
      const resultadoBloco = await knex.raw(query);
      resultados.push(...resultadoBloco.rows);
    }

    console.log("\n✅ Resultados finais:");
    console.table(resultados);

    const cabecalho = "codfatura,nome,data";
    const linhas = resultados.map(r => `${r.codfatura},"${r.nome}",${r.data}`);
    const conteudoCSV = [cabecalho, ...linhas].join("\n");

    // 💾 Salvando no arquivo
    fs.writeFileSync("resultadosNovo2.csv", conteudoCSV, "utf8");
    console.log("📁 Arquivo 'resultados.csv' salvo com sucesso!");
  } catch (error) {
    console.error("❌ Erro ao executar consultas:", error.message);
  } finally {
    await knex.destroy();
  }
})();
